<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NCIDQ Quiz with Save Progress</title>
<style>
  body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background:#f9f9f9; margin:0; padding:0; }
  .container { max-width:700px; margin: 30px auto; background:white; padding:20px; border-radius:10px; box-shadow:0 0 15px rgba(0,0,0,0.1); }
  h1 { text-align:center; color:#4CAF50; }
  .question { margin-bottom:20px; }
  .options { list-style:none; padding:0; }
  .options li { margin-bottom:10px; }
  button { padding:10px 20px; background:#4CAF50; color:white; border:none; border-radius:5px; cursor:pointer; }
  button:disabled { background:#ccc; cursor:not-allowed; }
  .result { margin-top:20px; padding:15px; background:#e8f5e9; border-radius:8px; }
  .incorrect { background:#ffebee; }
  .correct { font-weight:bold; color:#4CAF50; }
</style>
</head>
<body>

<div class="container">
  <h1>NCIDQ Quiz</h1>
  <div id="quiz"></div>
  <button id="nextBtn">Next Question</button>
  <div id="results"></div>
</div>

<script>
let questions = [];
let currentQuestion = 0;
let userAnswers = JSON.parse(localStorage.getItem("userAnswers")) || [];
let savedQuestion = localStorage.getItem("currentQuestion");
if (savedQuestion) currentQuestion = parseInt(savedQuestion);

const quizDiv = document.getElementById('quiz');
const nextBtn = document.getElementById('nextBtn');
const resultsDiv = document.getElementById('results');

// Load questions from JSON file
fetch("questions.json")
  .then(response => response.json())
  .then(data => {
    questions = data;
    if (userAnswers.length > 0) {
      // Resume where left off
      if (currentQuestion < questions.length) {
        loadQuestion();
      } else {
        showResults();
      }
    } else {
      loadQuestion();
    }
  });

// Load one question
function loadQuestion() {
  const q = questions[currentQuestion];
  let html = `<div class="question"><strong>Topic: ${q.topic}</strong><p>${q.question}</p></div><ul class="options">`;
  for (let key in q.options) {
    const checked = userAnswers[currentQuestion]?.selected === key ? "checked" : "";
    html += `<li><label><input type="radio" name="answer" value="${key}" ${checked}> ${key}: ${q.options[key]}</label></li>`;
  }
  html += "</ul>";
  quizDiv.innerHTML = html;

  if (currentQuestion === questions.length - 1) nextBtn.textContent = "Finish";
}

// Save answer and move forward
nextBtn.addEventListener('click', () => {
  const selected = document.querySelector('input[name="answer"]:checked');
  if (!selected) { alert("Please select an answer."); return; }

  userAnswers[currentQuestion] = { questionId: questions[currentQuestion].id, selected: selected.value };

  // Save progress in localStorage
  localStorage.setItem("userAnswers", JSON.stringify(userAnswers));
  localStorage.setItem("currentQuestion", currentQuestion);

  currentQuestion++;
  if (currentQuestion < questions.length) {
    loadQuestion();
  } else {
    showResults();
  }
});

// Show results with explanations
function showResults() {
  quizDiv.innerHTML = "";
  nextBtn.style.display = "none";
  localStorage.clear(); // clear progress when finished
  let html = "<h2>Results</h2>";
  questions.forEach((q, index) => {
    const user = userAnswers[index]?.selected || "No Answer";
    const isCorrect = user === q.correct;
    html += `<div class="result ${isCorrect ? "correct" : "incorrect"}">`;
    html += `<strong>Topic:</strong> ${q.topic}<br>`;
    html += `<strong>Q:</strong> ${q.question}<br>`;
    html += `<strong>Your answer:</strong> ${user} - ${q.options[user] || "Not answered"}<br>`;
    html += `<strong>Correct answer:</strong> ${q.correct} - ${q.options[q.correct]}<br>`;
    html += `<strong>Explanation:</strong> ${q.explanation}</div><br>`;
  });
  resultsDiv.innerHTML = html;
}
</script>

</body>
</html>
